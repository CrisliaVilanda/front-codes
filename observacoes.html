<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Adicionar observações ao processo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="css/style.css">
  <!-- Quill (WYSIWYG sem API key) -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
  <style>
    /* alinhamento visual seguindo o padrão do projeto */
    .editor-card {
      min-height: 340px;
    }

    .saved-list td {
      vertical-align: middle;
    }

    .wysiwyg-actions .btn {
      min-width: 88px;
    }
  </style>
</head>

<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4">
    <div class="container">
      <a class="navbar-brand fw-bold text-primary" href="index.html"><i class="bi bi-calendar-event me-2"></i>Adicionar
        observações ao processo</a>
      <div class="ms-auto">
        <a class="btn btn-outline-secondary" href="index.html"><i class="bi bi-arrow-left-circle me-1"></i> Voltar</a>
      </div>
    </div>
  </nav>

  <aside id="appSidebar" class="app-sidebar collapsed" role="complementary" aria-label="Menu lateral do aplicativo"
    tabindex="0">
    <div class="brand">
      <i class="bi bi-calendar-event fs-4 text-primary" aria-hidden="true"></i>
      <span class="brand-text sidebar-label">Agenda</span>
      <button id="sidebarToggle" class="ms-auto" aria-expanded="false" aria-controls="appSidebar"
        title="Alternar menu"><i class="bi bi-list" aria-hidden="true"></i><span class="visually-hidden">Alternar
          menu</span></button>
    </div>
    <nav class="nav" aria-label="Navegação principal">
      <a href="index.html#minhaAgenda" class="nav-link sidebar-link" id="sidebarCalendar"><i
          class="bi bi-calendar2-event"></i><span class="sidebar-label"> Calendário</span></a>
      <a href="index.html#calendarGrid2" class="nav-link"><i class="bi bi-gavel"></i><span class="sidebar-label"> Minhas
          audiências</span></a>
      <a href="observacoes.html" class="nav-link"><i class="bi bi-pin-angle"></i><span class="sidebar-label">
          Observações</span></a>
      <a href="todas_audiencias.html" class="nav-link"><i class="bi bi-calendar2-event"></i><span class="sidebar-label">
          Ver todas as audiências</span></a>
      <a href="atividades_realizadas.html" class="nav-link active"><i class="bi bi-list-check"></i><span
          class="sidebar-label">
          Atividades realizadas</span></a>
    </nav>
  </aside>

  <main class="container mb-5">
    <div class="row">
      <div class="col-12">
        <div class="card shadow-sm border-0 editor-card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h5 class="mb-0">Observações — Editor</h5>
              <!-- <div class="text-end text-muted small">Editor TinyMCE — conteúdo salvo localmente (localStorage).</div> -->
            </div>

            <!-- metadados da anotação -->
            <div class="row g-2 mb-3 align-items-end">
              <div class="col-md-4">
                <label for="obsNome" class="form-label">Nome (usuário)</label>
                <input id="obsNome" class="form-control" placeholder="Nome do usuário" required>
                <div id="obsNomeError" class="form-text text-danger visually-hidden" role="alert"></div>
              </div>
              <div class="col-md-3">
                <label for="obsPapel" class="form-label">Papel</label>
                <select id="obsPapel" class="form-select" required>
                  <option value="">— selecione —</option>
                  <option>Colaborador(a)</option>
                  <option>Defensor(a)</option>
                  <option>Estagiário(a)</option>
                </select>
                <div id="obsPapelError" class="form-text text-danger visually-hidden" role="alert"></div>
              </div>
              <div class="col-md-3 d-flex align-items-center">
                <div class="form-check mt-2">
                  <input id="obsSigiloso" class="form-check-input" type="checkbox">
                  <label class="form-check-label small" for="obsSigiloso">Sigiloso?</label>
                </div>
              </div>
              <div class="col-md-2 text-end">
                <button id="clearObsBtn" type="button" class="btn btn-outline-secondary">Limpar</button>
              </div>
            </div>

            <div>
              <div id="quillEditor" style="min-height:320px;"></div>
            </div>

            <div class="mt-3 d-flex justify-content-end gap-2">
              <div class="me-auto align-self-center text-muted small" id="saveStatus" aria-live="polite"></div>
              <button id="loadObsBtn" type="button" class="btn btn-outline-secondary">Carregar</button>
              <button id="saveObsBtn" type="button" class="btn btn-primary"><i class="bi bi-save me-1"></i>
                Salvar</button>
            </div>

            <!-- sessão abaixo: registros salvos (metadados) -->
            <hr class="my-4">
            <h6 class="mb-3">Sessão de anotações</h6>
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle">
                <thead class="table-light small">
                  <tr>
                    <th>Nome</th>
                    <th>Papel</th>
                    <th>Sigiloso</th>
                    <th class="text-end">Ações</th>
                  </tr>
                </thead>
                <tbody id="observacoesListTbody">
                  <tr>
                    <td colspan="4" class="text-muted small">Nenhum registro cadastrado.</td>
                  </tr>
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="previewTitle" class="modal-title">Visualizar anotação</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body" id="previewBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const sidebar = document.getElementById('appSidebar');
      const toggle = document.getElementById('sidebarToggle');
      const link = document.querySelector('.sidebar-link');
      const container = document.querySelector('.container');
      if (!sidebar) return;

      const mq = window.matchMedia('(min-width:768px)');
      const saved = localStorage.getItem('sidebarExpanded');
      const defaultExpanded = mq.matches;
      let expanded = saved === null ? defaultExpanded : saved === 'true';

      function applyState() {
        sidebar.classList.toggle('expanded', expanded);
        sidebar.classList.toggle('collapsed', !expanded);
        if (toggle) toggle.setAttribute('aria-expanded', String(!!expanded));
        if (container) container.classList.toggle('with-sidebar', expanded && window.innerWidth >= 768);
      }
      applyState();

      function setSidebarExpanded(v) {
        expanded = !!v;
        localStorage.setItem('sidebarExpanded', String(expanded));
        applyState();
      }

      if (toggle) {
        toggle.addEventListener('click', (ev) => { ev.preventDefault(); setSidebarExpanded(!expanded); });
        toggle.addEventListener('keydown', (ev) => { if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); setSidebarExpanded(!expanded); } });
      }

      if (link) link.addEventListener('click', (ev) => { link.classList.add('active'); setTimeout(() => link.classList.remove('active'), 800); });

      try {
        const target = document.getElementById('minhaAgenda');
        if (target) {
          const io = new IntersectionObserver(entries => {
            entries.forEach(en => link.classList.toggle('active', en.isIntersecting));
          }, { threshold: 0.35 });
          io.observe(target);
        }
      } catch (e) { /* noop */ }

      document.addEventListener('keydown', (ev) => { if (ev.key === 'Escape' && window.innerWidth < 768 && expanded) setSidebarExpanded(false); });
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <script src="js/script_observacoes.js"></script>

</body>

</html>